<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareLink - Real-Time Healthcare Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #4ecdc4;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .dashboard {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .main-panel {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .role-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .role-patient { background: #e8f4ff; color: #2196f3; }
        .role-doctor { background: #e8f8f5; color: #00bcd4; }
        .role-delivery { background: #fff3e0; color: #ff9800; }

        .vitals-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .vital-item {
            background: #f8faff;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #4ecdc4;
        }

        .vital-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.3rem;
        }

        .vital-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-indicator {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .risk-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .risk-yellow { background: #f39c12; }
        .risk-orange { background: #e67e22; }
        .risk-red { background: #e74c3c; }
        .risk-green { background: #27ae60; }

        .alerts-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .alert-item {
            background: #fff5f5;
            border-left: 4px solid #ff6b6b;
            padding: 1rem;
            margin-bottom: 0.8rem;
            border-radius: 8px;
            animation: fadeInUp 0.5s ease;
        }

        .alert-urgent { border-left-color: #e74c3c; background: #ffebee; }
        .alert-moderate { border-left-color: #f39c12; background: #fff8e1; }
        .alert-low { border-left-color: #27ae60; background: #e8f5e8; }

        .alert-time {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 0.3rem;
        }

        .alert-message {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .alert-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #4ecdc4;
            color: white;
        }

        .btn-primary:hover {
            background: #45b7aa;
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .delivery-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8faff;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .status-progress {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .map-container {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .map-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: mapPulse 2s infinite;
        }

        .dot-patient { background: #2196f3; top: 40%; left: 30%; }
        .dot-doctor { background: #00bcd4; top: 60%; left: 60%; }
        .dot-delivery { background: #ff9800; top: 70%; left: 45%; }

        @keyframes mapPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8faff;
            border-radius: 12px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4ecdc4;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 0.3rem;
        }

        .notification-toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-left: 4px solid #ff6b6b;
            animation: slideInRight 0.3s ease;
            z-index: 1001;
            min-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            color: #27ae60;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @media (max-width: 1200px) {
            .main-panel { grid-template-columns: 1fr 1fr; }
            .dashboard { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .main-panel { grid-template-columns: 1fr; }
            .vitals-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .header-content { flex-direction: column; gap: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="pulse-dot"></div>
                CareLink
            </div>
            <div class="status-indicator">
                <div class="live-dot"></div>
                System Online - 24/7 Monitoring
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="main-panel">
            <!-- Patient Dashboard -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Patient Monitor</h3>
                    <span class="role-badge role-patient">Patient</span>
                </div>
                
                <div class="vitals-grid">
                    <div class="vital-item">
                        <div class="vital-value" id="heartRate">78</div>
                        <div class="vital-label">Heart Rate</div>
                    </div>
                    <div class="vital-item">
                        <div class="vital-value" id="oxygenLevel">97%</div>
                        <div class="vital-label">Oxygen</div>
                    </div>
                    <div class="vital-item">
                        <div class="vital-value" id="temperature">98.6¬∞F</div>
                        <div class="vital-label">Temperature</div>
                    </div>
                    <div class="vital-item">
                        <div class="vital-value" id="bloodPressure">120/80</div>
                        <div class="vital-label">Blood Pressure</div>
                    </div>
                </div>

                <div class="risk-indicator">
                    <div class="risk-fill risk-green" id="riskFill" style="width: 25%"></div>
                </div>

                <div class="live-indicator" style="margin-top: 1rem;">
                    <div class="live-dot"></div>
                    Live Monitoring - Sarah Johnson (ID: P001)
                </div>
            </div>

            <!-- Doctor Dashboard -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Doctor Console</h3>
                    <span class="role-badge role-doctor">Doctor</span>
                </div>

                <div class="alerts-list" id="doctorAlerts">
                    <!-- Alerts will be populated by JavaScript -->
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="activePatients">12</div>
                        <div class="stat-label">Active Patients</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="urgentCases">2</div>
                        <div class="stat-label">Urgent Cases</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="completedToday">8</div>
                        <div class="stat-label">Completed Today</div>
                    </div>
                </div>
            </div>

            <!-- Delivery Dashboard -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Delivery Tracking</h3>
                    <span class="role-badge role-delivery">Delivery</span>
                </div>

                <div class="delivery-status">
                    <div>
                        <strong>Order #MD2024001</strong>
                        <div style="font-size: 0.9rem; color: #7f8c8d; margin-top: 0.3rem;">
                            Emergency Medicine - Sarah Johnson
                        </div>
                    </div>
                    <div style="color: #ff9800; font-weight: 500;">In Transit</div>
                </div>

                <div class="status-progress">
                    <div class="progress-bar" id="deliveryProgress" style="width: 65%"></div>
                </div>

                <div class="map-container">
                    <div class="map-dot dot-patient"></div>
                    <div class="map-dot dot-doctor"></div>
                    <div class="map-dot dot-delivery"></div>
                </div>

                <div style="text-align: center; margin-top: 1rem; color: #7f8c8d; font-size: 0.9rem;">
                    ETA: 8 minutes | Driver: Raj Kumar | Contact: +91-98765-43210
                </div>
            </div>
        </div>

        <!-- Real-time Activity Feed -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Live Activity Feed</h3>
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    Real-time Updates
                </div>
            </div>

            <div class="alerts-list" id="activityFeed">
                <!-- Activity feed will be populated by JavaScript -->
            </div>
        </div>

        <!-- System Analytics -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">System Analytics</h3>
                <span style="color: #7f8c8d; font-size: 0.9rem;">Last 24 Hours</span>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">147</div>
                    <div class="stat-label">Total Alerts</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">23</div>
                    <div class="stat-label">Emergency Calls</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">98.7%</div>
                    <div class="stat-label">System Uptime</div>
                </div>
            </div>

            <div style="margin-top: 2rem;">
                <h4 style="margin-bottom: 1rem; color: #2c3e50;">Response Times</h4>
                <div class="vital-item" style="margin-bottom: 0.8rem;">
                    <div class="vital-value" style="font-size: 1.3rem; color: #27ae60;">2.3 min</div>
                    <div class="vital-label">Avg Doctor Response</div>
                </div>
                <div class="vital-item">
                    <div class="vital-value" style="font-size: 1.3rem; color: #4ecdc4;">12.7 min</div>
                    <div class="vital-label">Avg Delivery Time</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real-time data simulation
        let patients = [
            { id: 'P001', name: 'Sarah Johnson', heartRate: 78, oxygen: 97, temperature: 98.6, bloodPressure: '120/80', riskLevel: 'green' },
            { id: 'P002', name: 'Mike Chen', heartRate: 92, oxygen: 94, temperature: 99.2, bloodPressure: '140/90', riskLevel: 'yellow' },
            { id: 'P003', name: 'Emma Williams', heartRate: 115, oxygen: 91, temperature: 100.4, bloodPressure: '160/95', riskLevel: 'red' }
        ];

        let deliveries = [
            { id: 'MD2024001', patient: 'Sarah Johnson', status: 'In Transit', progress: 65, eta: 8, driver: 'Raj Kumar' },
            { id: 'MD2024002', patient: 'Mike Chen', status: 'Dispatched', progress: 25, eta: 15, driver: 'Priya Sharma' }
        ];

        let activityLog = [];

        // Update vitals every 2 seconds
        function updateVitals() {
            const currentPatient = patients[0]; // Sarah Johnson
            
            // Simulate realistic vital fluctuations
            currentPatient.heartRate += Math.random() * 4 - 2; // ¬±2 bpm
            currentPatient.oxygen += Math.random() * 2 - 1; // ¬±1%
            currentPatient.temperature += Math.random() * 0.4 - 0.2; // ¬±0.2¬∞F
            
            // Ensure values stay within realistic ranges
            currentPatient.heartRate = Math.max(60, Math.min(120, currentPatient.heartRate));
            currentPatient.oxygen = Math.max(88, Math.min(100, currentPatient.oxygen));
            currentPatient.temperature = Math.max(97.0, Math.min(102.0, currentPatient.temperature));

            // Update display
            document.getElementById('heartRate').textContent = Math.round(currentPatient.heartRate);
            document.getElementById('oxygenLevel').textContent = Math.round(currentPatient.oxygen) + '%';
            document.getElementById('temperature').textContent = currentPatient.temperature.toFixed(1) + '¬∞F';

            // Update risk level
            updateRiskLevel(currentPatient);
        }

        function updateRiskLevel(patient) {
            let riskPercent = 25; // Default green
            let riskClass = 'risk-green';

            if (patient.heartRate > 100 || patient.oxygen < 95 || patient.temperature > 99.5) {
                riskPercent = 60;
                riskClass = 'risk-yellow';
                patient.riskLevel = 'yellow';
            }

            if (patient.heartRate > 110 || patient.oxygen < 92 || patient.temperature > 100.5) {
                riskPercent = 85;
                riskClass = 'risk-red';
                patient.riskLevel = 'red';
                
                // Generate alert for high risk
                generateAlert('urgent', `High risk detected for ${patient.name}`, `HR: ${Math.round(patient.heartRate)}, O2: ${Math.round(patient.oxygen)}%`);
            }

            const riskFill = document.getElementById('riskFill');
            riskFill.style.width = riskPercent + '%';
            riskFill.className = 'risk-fill ' + riskClass;
        }

        function generateAlert(severity, message, details) {
            const alert = {
                id: Date.now(),
                severity,
                message,
                details,
                timestamp: new Date()
            };

            // Add to activity log
            activityLog.unshift({
                type: 'alert',
                severity,
                message: `${message} - ${details}`,
                timestamp: new Date()
            });

            updateDoctorAlerts();
            updateActivityFeed();

            // Show notification toast for urgent alerts
            if (severity === 'urgent') {
                showNotificationToast(message, details);
            }
        }

        function updateDoctorAlerts() {
            const alertsContainer = document.getElementById('doctorAlerts');
            const recentAlerts = activityLog.filter(item => item.type === 'alert').slice(0, 3);

            alertsContainer.innerHTML = recentAlerts.map(alert => `
                <div class="alert-item alert-${alert.severity}">
                    <div class="alert-time">${alert.timestamp.toLocaleTimeString()}</div>
                    <div class="alert-message">${alert.message}</div>
                    <div class="alert-actions">
                        <button class="btn btn-primary" onclick="respondToAlert('${alert.timestamp}')">Respond</button>
                        <button class="btn btn-secondary" onclick="dismissAlert('${alert.timestamp}')">Dismiss</button>
                    </div>
                </div>
            `).join('');
        }

        function updateActivityFeed() {
            const feedContainer = document.getElementById('activityFeed');
            const recentActivity = activityLog.slice(0, 8);

            feedContainer.innerHTML = recentActivity.map(item => {
                const icon = item.type === 'alert' ? 'üö®' : 
                           item.type === 'delivery' ? 'üöõ' : 
                           item.type === 'doctor' ? 'üë®‚Äç‚öïÔ∏è' : 'üìä';
                
                return `
                    <div class="alert-item alert-low" style="border-left-color: #4ecdc4; background: #f0fffe;">
                        <div class="alert-time">${item.timestamp.toLocaleTimeString()}</div>
                        <div class="alert-message">${icon} ${item.message}</div>
                    </div>
                `;
            }).join('');
        }

        function updateDeliveryProgress() {
            deliveries.forEach(delivery => {
                if (delivery.status === 'In Transit' && delivery.progress < 100) {
                    delivery.progress += Math.random() * 3;
                    delivery.eta = Math.max(1, delivery.eta - 0.1);
                    
                    if (delivery.progress >= 100) {
                        delivery.status = 'Delivered';
                        delivery.eta = 0;
                        
                        activityLog.unshift({
                            type: 'delivery',
                            message: `Medicine delivered to ${delivery.patient} by ${delivery.driver}`,
                            timestamp: new Date()
                        });
                    }
                }
            });

            // Update main delivery display
            const mainDelivery = deliveries[0];
            document.getElementById('deliveryProgress').style.width = Math.min(100, mainDelivery.progress) + '%';
        }

        function showNotificationToast(message, details) {
            const existingToast = document.querySelector('.notification-toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 0.5rem;">üö® Urgent Alert</div>
                <div style="margin-bottom: 0.3rem;">${message}</div>
                <div style="font-size: 0.9rem; color: #7f8c8d;">${details}</div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function respondToAlert(timestamp) {
            activityLog.unshift({
                type: 'doctor',
                message: 'Dr. Mehta responded to patient alert - Dispatching emergency team',
                timestamp: new Date()
            });
            updateActivityFeed();
            updateDoctorAlerts();
        }

        function dismissAlert(timestamp) {
            activityLog.unshift({
                type: 'doctor',
                message: 'Alert dismissed after review - Patient status stable',
                timestamp: new Date()
            });
            updateActivityFeed();
            updateDoctorAlerts();
        }

        // Generate random system activity
        function generateSystemActivity() {
            const activities = [
                'New patient registered: John Doe (ID: P004)',
                'Dr. Patel completed consultation for Patient P002',
                'Medicine restocked at Pharmacy Hub - Udaipur',
                'System backup completed successfully',
                'New delivery partner added: Express Medical',
                'Patient P001 completed daily health check-in',
                'Emergency response time improved by 15%',
                'AI model updated with new health patterns'
            ];

            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            
            activityLog.unshift({
                type: 'system',
                message: randomActivity,
                timestamp: new Date()
            });

            updateActivityFeed();
        }

        // Update counters randomly
        function updateCounters() {
            const activePatients = document.getElementById('activePatients');
            const urgentCases = document.getElementById('urgentCases');
            const completedToday = document.getElementById('completedToday');

            // Simulate realistic changes
            if (Math.random() < 0.3) {
                const currentActive = parseInt(activePatients.textContent);
                activePatients.textContent = Math.max(8, Math.min(20, currentActive + (Math.random() > 0.5 ? 1 : -1)));
            }

            if (Math.random() < 0.2) {
                const currentUrgent = parseInt(urgentCases.textContent);
                urgentCases.textContent = Math.max(0, Math.min(5, currentUrgent + (Math.random() > 0.7 ? 1 : 0)));
            }

            if (Math.random() < 0.4) {
                const currentCompleted = parseInt(completedToday.textContent);
                completedToday.textContent = currentCompleted + (Math.random() > 0.5 ? 1 : 0);
            }
        }

        // Initialize system
        function initializeSystem() {
            // Add some initial activity
            activityLog.push(
                { type: 'system', message: 'CareLink system started - All modules online', timestamp: new Date(Date.now() - 300000) },
                { type: 'doctor', message: 'Dr. Mehta started morning shift', timestamp: new Date(Date.now() - 240000) },
                { type: 'delivery', message: 'Raj Kumar started delivery route', timestamp: new Date(Date.now() - 180000) },
                { type: 'alert', severity: 'low', message: 'Patient P002 completed medication reminder', timestamp: new Date(Date.now() - 120000) }
            );

            updateActivityFeed();
            updateDoctorAlerts();
        }

        // Start all real-time updates
        initializeSystem();
        
        setInterval(updateVitals, 2000);           // Update vitals every 2 seconds
        setInterval(updateDeliveryProgress, 3000); // Update delivery every 3 seconds
        setInterval(generateSystemActivity, 15000); // Generate activity every 15 seconds
        setInterval(updateCounters, 8000);         // Update counters every 8 seconds

        // Generate initial urgent alert for demonstration
        setTimeout(() => {
            generateAlert('urgent', 'Irregular heartbeat detected', 'Patient requires immediate attention');
        }, 5000);

        console.log('CareLink Real-time Dashboard initialized successfully!');
        console.log('ü©∫ Patient monitoring active');
        console.log('üë®‚Äç‚öïÔ∏è Doctor console ready');
        console.log('üöõ Delivery tracking online');

        // Advanced AI Risk Assessment
        function performAIRiskAssessment(patient) {
            const riskFactors = {
                heartRate: patient.heartRate > 100 ? (patient.heartRate - 100) * 0.5 : 0,
                oxygen: patient.oxygen < 95 ? (95 - patient.oxygen) * 2 : 0,
                temperature: patient.temperature > 99.0 ? (patient.temperature - 99.0) * 3 : 0,
                bloodPressureSystolic: parseInt(patient.bloodPressure.split('/')[0]) > 140 ? 
                    (parseInt(patient.bloodPressure.split('/')[0]) - 140) * 0.3 : 0
            };

            const totalRisk = Object.values(riskFactors).reduce((sum, risk) => sum + risk, 0);
            
            let aiRecommendation = '';
            let priority = 'low';

            if (totalRisk > 15) {
                aiRecommendation = 'Immediate medical intervention required. Dispatch emergency response team.';
                priority = 'urgent';
            } else if (totalRisk > 8) {
                aiRecommendation = 'Schedule virtual consultation within 1 hour. Monitor closely.';
                priority = 'moderate';
            } else if (totalRisk > 3) {
                aiRecommendation = 'Increase monitoring frequency. Send medication reminder.';
                priority = 'low';
            } else {
                aiRecommendation = 'Patient status normal. Continue routine monitoring.';
                priority = 'normal';
            }

            return { totalRisk, aiRecommendation, priority, riskFactors };
        }

        // Enhanced Doctor Response System
        function simulateDoctorResponse(alertId, responseType) {
            const responses = {
                'immediate': {
                    action: 'Emergency team dispatched',
                    eta: '5-8 minutes',
                    doctor: 'Dr. Mehta (Cardiologist)'
                },
                'consultation': {
                    action: 'Virtual consultation scheduled',
                    eta: '15 minutes',
                    doctor: 'Dr. Priya Sharma (General Medicine)'
                },
                'monitoring': {
                    action: 'Enhanced monitoring activated',
                    eta: 'Continuous',
                    doctor: 'AI System + Dr. Raj Kumar'
                }
            };

            const response = responses[responseType];
            
            activityLog.unshift({
                type: 'doctor',
                message: `${response.action} by ${response.doctor} - ETA: ${response.eta}`,
                timestamp: new Date()
            });

            updateActivityFeed();
        }

        // Geo-location and Route Optimization
        function updateDeliveryRoutes() {
            const routes = [
                { from: 'Central Pharmacy', to: 'Patient Location', distance: '2.3 km', traffic: 'Light' },
                { from: 'Doctor Clinic', to: 'Patient Location', distance: '1.8 km', traffic: 'Moderate' },
                { from: 'Emergency Center', to: 'Patient Location', distance: '3.1 km', traffic: 'Heavy' }
            ];

            // Simulate dynamic route optimization
            routes.forEach(route => {
                const trafficFactor = route.traffic === 'Heavy' ? 1.5 : route.traffic === 'Moderate' ? 1.2 : 1.0;
                route.eta = Math.round(parseFloat(route.distance) * 3 * trafficFactor);
            });

            return routes;
        }

        // Medicine Inventory Management
        let medicineInventory = {
            'Emergency Kit A': { quantity: 15, location: 'Central Pharmacy', type: 'Cardiac Emergency' },
            'Emergency Kit B': { quantity: 8, location: 'City Hospital', type: 'Respiratory' },
            'Insulin Pens': { quantity: 23, location: 'Diabetes Center', type: 'Diabetes' },
            'Blood Pressure Meds': { quantity: 31, location: 'Central Pharmacy', type: 'Hypertension' }
        };

        function checkMedicineAvailability(medicationType) {
            const available = Object.entries(medicineInventory)
                .filter(([name, details]) => details.type.toLowerCase().includes(medicationType.toLowerCase()))
                .map(([name, details]) => ({ name, ...details }));

            return available.length > 0 ? available[0] : null;
        }

        // Enhanced Notification System
        function createAdvancedNotification(type, data) {
            const notifications = {
                'critical_vitals': {
                    title: 'üö® Critical Vitals Alert',
                    message: `Patient ${data.patientName} showing critical signs`,
                    actions: ['Dispatch Emergency', 'Schedule Consultation', 'Increase Monitoring']
                },
                'medicine_dispatched': {
                    title: 'üíä Medicine Dispatched',
                    message: `${data.medicine} dispatched to ${data.patientName}`,
                    actions: ['Track Delivery', 'Contact Patient', 'View Details']
                },
                'doctor_assigned': {
                    title: 'üë®‚Äç‚öïÔ∏è Doctor Assigned',
                    message: `${data.doctorName} assigned to emergency case`,
                    actions: ['View Patient Data', 'Start Video Call', 'Send Instructions']
                }
            };

            const notification = notifications[type];
            if (notification) {
                showAdvancedToast(notification, data);
            }
        }

        function showAdvancedToast(notification, data) {
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.style.minWidth = '350px';
            toast.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 0.8rem; font-size: 1.1rem;">${notification.title}</div>
                <div style="margin-bottom: 1rem; line-height: 1.4;">${notification.message}</div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    ${notification.actions.map(action => 
                        `<button class="btn btn-primary" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;" 
                         onclick="handleNotificationAction('${action}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">${action}</button>`
                    ).join('')}
                </div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 8000);
        }

        function handleNotificationAction(action, data) {
            console.log('Notification action:', action, data);
            
            const actionMessages = {
                'Dispatch Emergency': 'Emergency team dispatched - ETA 6 minutes',
                'Schedule Consultation': 'Video consultation scheduled in 10 minutes',
                'Increase Monitoring': 'Monitoring frequency increased to every 30 seconds',
                'Track Delivery': 'Tracking delivery - Current location: City Center',
                'Contact Patient': 'Calling patient now...',
                'View Patient Data': 'Opening detailed patient profile',
                'Start Video Call': 'Initiating secure video call',
                'Send Instructions': 'Pre-arrival instructions sent to patient'
            };

            activityLog.unshift({
                type: 'system',
                message: actionMessages[action] || `Action completed: ${action}`,
                timestamp: new Date()
            });

            updateActivityFeed();
            
            // Remove the toast
            const toast = document.querySelector('.notification-toast');
            if (toast) toast.remove();
        }

        // Patient Health Pattern Learning
        let patientHealthPatterns = {
            'P001': {
                baselineHR: 75,
                baselineO2: 98,
                baselineTemp: 98.4,
                dailyPattern: 'Morning: Lower HR, Evening: Slight temp increase',
                riskFactors: ['Family history of heart disease'],
                medications: ['Lisinopril 10mg', 'Metformin 500mg'],
                lastEmergency: null
            }
        };

        function updateHealthBaseline(patientId, currentVitals) {
            if (!patientHealthPatterns[patientId]) return;

            const pattern = patientHealthPatterns[patientId];
            const hour = new Date().getHours();

            // Adjust baselines gradually (learning)
            pattern.baselineHR = (pattern.baselineHR * 0.95) + (currentVitals.heartRate * 0.05);
            pattern.baselineO2 = (pattern.baselineO2 * 0.95) + (currentVitals.oxygen * 0.05);
            pattern.baselineTemp = (pattern.baselineTemp * 0.95) + (currentVitals.temperature * 0.05);

            // Check for pattern deviations
            const hrDeviation = Math.abs(currentVitals.heartRate - pattern.baselineHR);
            const o2Deviation = Math.abs(currentVitals.oxygen - pattern.baselineO2);
            const tempDeviation = Math.abs(currentVitals.temperature - pattern.baselineTemp);

            if (hrDeviation > 15 || o2Deviation > 3 || tempDeviation > 1.5) {
                activityLog.unshift({
                    type: 'alert',
                    severity: 'moderate',
                    message: `Deviation from baseline detected for Patient ${patientId}`,
                    timestamp: new Date()
                });
                updateActivityFeed();
            }
        }

        // Integration with External Systems
        function simulateHospitalIntegration() {
            const hospitalSystems = [
                'AIIMS Udaipur - Bed Available: ICU-204',
                'Narayana Hospital - Emergency dept ready',
                'Apollo Hospital - Cardiology specialist on call',
                'Max Hospital - Ambulance dispatched'
            ];

            const randomSystem = hospitalSystems[Math.floor(Math.random() * hospitalSystems.length)];
            
            activityLog.unshift({
                type: 'system',
                message: `Hospital Integration: ${randomSystem}`,
                timestamp: new Date()
            });

            updateActivityFeed();
        }

        // Weather and Environmental Factors
        function checkEnvironmentalFactors() {
            const environmentalData = {
                temperature: 42, // Celsius (Udaipur can get hot!)
                humidity: 65,
                airQuality: 'Moderate',
                heatIndex: 'High',
                recommendations: [
                    'Increase hydration monitoring for elderly patients',
                    'Adjust medication timings for heat-sensitive drugs',
                    'Enhanced monitoring for cardiovascular patients'
                ]
            };

            if (environmentalData.temperature > 40) {
                activityLog.unshift({
                    type: 'system',
                    message: `Heat Alert: Temperature ${environmentalData.temperature}¬∞C - Enhanced patient monitoring activated`,
                    timestamp: new Date()
                });
                updateActivityFeed();
            }

            return environmentalData;
        }

        // Enhanced delivery tracking with real locations
        function updateRealTimeDeliveryTracking() {
            const udaipurLocations = [
                'City Palace Area',
                'Fateh Sagar Lake',
                'Chetak Circle',
                'Surajpole',
                'University Road',
                'Hiran Magri',
                'Sector 14',
                'Goverdhan Villas'
            ];

            const currentDelivery = deliveries[0];
            if (currentDelivery && currentDelivery.status === 'In Transit') {
                const randomLocation = udaipurLocations[Math.floor(Math.random() * udaipurLocations.length)];
                
                activityLog.unshift({
                    type: 'delivery',
                    message: `Delivery ${currentDelivery.id} passed ${randomLocation} - ETA ${Math.round(currentDelivery.eta)} minutes`,
                    timestamp: new Date()
                });
                updateActivityFeed();
            }
        }

        // Start enhanced real-time systems
        setInterval(() => {
            const currentPatient = patients[0];
            updateHealthBaseline('P001', currentPatient);
            
            // Perform AI risk assessment
            const aiAssessment = performAIRiskAssessment(currentPatient);
            
            if (aiAssessment.priority === 'urgent') {
                createAdvancedNotification('critical_vitals', {
                    patientName: currentPatient.name,
                    riskScore: aiAssessment.totalRisk,
                    recommendation: aiAssessment.aiRecommendation
                });
            }
        }, 5000);

        setInterval(simulateHospitalIntegration, 25000);
        setInterval(checkEnvironmentalFactors, 30000);
        setInterval(updateRealTimeDeliveryTracking, 7000);

        // Simulate some advanced notifications
        setTimeout(() => {
            createAdvancedNotification('doctor_assigned', {
                doctorName: 'Dr. Priya Mehta',
                patientName: 'Sarah Johnson',
                specialization: 'Cardiologist'
            });
        }, 10000);

        setTimeout(() => {
            createAdvancedNotification('medicine_dispatched', {
                medicine: 'Emergency Cardiac Kit',
                patientName: 'Sarah Johnson',
                deliveryId: 'MD2024001'
            });
        }, 15000);
        // console.log('

</script>
</body>
</html>